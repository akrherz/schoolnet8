<?php
include("../../config/settings.inc.php");
include("$nwnpath/include/locs.inc.php");
include("$nwnpath/include/sponsors.inc.php");
include("$nwnpath/include/cameras.inc.php");
$app = "21"; include("$nwnpath/include/dblog.inc.php"); 
$station = isset($_GET["station"]) ? $_GET["station"] : "SAMI4";
$defaultzoom = isset($_GET["station"]) ? 4 : 10;
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
   <style type="text/css" media="screen">@import "../css/main.css";</style>
    <!-- <script src="http://maps.google.com/maps?file=api&v=1&key=ABQIAAAArXt77YptylBNPFEy0AgJxBTvX-LZuEomi989jNN1ZEOlwjWzvxQ7MGfNs8Y2x60Nz7OWub34lSLt2Q" type="text/javascript"></script> -->
    <script src="http://maps.google.com/maps?file=api&v=1&key=ABQIAAAArXt77YptylBNPFEy0AgJxBSWGjM97_n1DGuQJrTtOc2ryLPhTRT0ZEoBlAqspunGo75mvllNuO-ZNg" type="text/javascript"></script>
    <script src="GMaps_WMSSpec_0.1.js" type="text/javascript"></script>
  </head>
  <body>
<?php include("$nwnpath/include/bar.inc.php"); ?>
<div id="justone">
<h2>Google Maps Interface</h2>
    <div id="map" style="margin-left: 20px; width: 640px; height: 480px"></div>
    <script type="text/javascript">
    //<![CDATA[
    var map = new GMap(document.getElementById("map"));
    var wms = new WMSSpec(map.mapTypes[0], "http://mesonet.agron.iastate.edu/cgi-bin/mapserv/mapserv.radar?map=/mesonet/www/html/GIS/apps/wms/compradar.map&", "RADAR", "nexrad", "default", "image/png" );
    map.mapTypes[map.mapTypes.length] = wms; 
    map.addControl(new GLargeMapControl());
    map.addControl(new GMapTypeControl());
    map.centerAndZoom(new GPoint(<?php echo $Scities[$station]["lon"]; ?>, <?php echo $Scities[$station]["lat"]; ?>), <?php echo $defaultzoom; ?>);

    function createMarker(point, site_name, site_abrev, lon, lat, sponsor, ui) {
      var marker = new GMarker(point);
      var html = "<a href='<?php echo $_BASEURL; ?>/site.phtml?station="+ site_abrev +"'>" + site_name + "</a><br />Sponsored by <a href='<?php echo $_BASEURL; ?>tool/clicktru.php?station="+ site_abrev +"'>"+ sponsor +"</a><br />"+ ui +"<br /><a href='javascript: map.centerAndZoom(new GPoint("+ lon +", "+ lat +"), 3);'>Zoom To Site!</a>";
      GEvent.addListener(marker, "click", function() {
         marker.openInfoWindowHtml(html);
      });
      return marker;
    }

<?php 
while (list($k,$v) = each($Scities)) {
?>
  var point = new GPoint(<?php echo $v["lon"]; ?>, <?php echo $v["lat"]; ?>);
  var marker = createMarker(point, "<?php echo $v["city"] ?>", "<?php echo $k; ?>", <?php echo $v["lon"]; ?>, <?php echo $v["lat"]; ?>, '<?php echo $sponsors[$k]["sponsor"]; ?>','<?php
if (array_key_exists($k, $cameras))
{
        if ($cameras[$k]["active"])
        {
		echo "<img src=\"$_BASEURL/camera/stills/${k}.jpg\" style=\"width: 320px; height: 240px;\"/>";
	}
} ?>'
);
  map.addOverlay(marker);
<?php } ?>

    //]]>
    </script>

<p>This page is a test interface using  <a href="http://maps.google.com">Google Maps</a>.  You can click on an icon to get the name of the SchoolNet8 site. The
link presented in the popup window takes you to the site's homepage. During
July, we are testing this page out to see how it works for you.  Please let
me know what you think!</p>
</div>
<?php include("$nwnpath/include/footer.inc.php"); ?>
  </body>
</html>
